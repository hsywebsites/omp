<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Онлайн Музыкальный Плеер</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/jsmediatags@3.9.7/dist/jsmediatags.min.js"></script>
    <style>
        :root {
            --primary-color: #b21f1f;
            --secondary-color: #b21f1f;
            --bg-gradient: linear-gradient(135deg, #1a2a6c, var(--secondary-color), #fdbb2d);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: var(--bg-gradient);
            color: white;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: background 0.5s ease;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
            position: relative;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.8;
        }

        .header-controls {
            position: absolute;
            top: 0;
            right: 0;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .theme-selector {
            display: flex;
            gap: 10px;
        }

        .theme-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .theme-btn.active {
            border-color: white;
            transform: scale(1.1);
        }

        .theme-btn:hover {
            transform: scale(1.1);
        }

        .theme-red {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
        }

        .theme-blue {
            background: linear-gradient(135deg, #00b09b, #096dd9);
        }

        .theme-green {
            background: linear-gradient(135deg, #1a2a6c, #1db954, #fdbb2d);
        }

        .theme-purple {
            background: linear-gradient(135deg, #1a2a6c, #8a2be2, #fdbb2d);
        }

        .language-btn {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 8px 15px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .language-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .language-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 5px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            display: none;
            z-index: 10;
            min-width: 150px;
        }

        .language-dropdown.active {
            display: block;
        }

        .language-option {
            padding: 10px 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .language-option:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .language-option.active {
            background: rgba(255, 255, 255, 0.3);
        }

        .player-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .player-container {
                flex-direction: column;
            }
            
            .header-controls {
                position: relative;
                top: auto;
                right: auto;
                margin-top: 15px;
                justify-content: center;
            }
        }

        .player-section {
            flex: 1;
            min-width: 300px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .playlist-section {
            flex: 1;
            min-width: 300px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .section-title {
            font-size: 1.5rem;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .now-playing {
            text-align: center;
            margin-bottom: 20px;
        }

        .song-info {
            margin: 15px 0;
        }

        .song-title {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .song-artist {
            font-size: 1.2rem;
            opacity: 0.8;
        }

        .album-art {
            width: 200px;
            height: 200px;
            margin: 0 auto 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
        }

        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 20px 0;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .play-pause {
            width: 60px;
            height: 60px;
            font-size: 1.5rem;
        }

        .progress-container {
            margin: 20px 0;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .progress {
            height: 100%;
            background: var(--primary-color);
            filter: brightness(2);
            opacity: 0.5;
            border-radius: 4px;
            width: 0%;
            transition: width 0.1s linear;
        }

        .time-display {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .playback-options-container {
            text-align: center;
            padding: 15px;
            border-style: solid;
            border-color: rgba(255, 255, 255, 0.1);
            border-width: 2px;
            border-radius: 15px;
            margin-bottom: 15px;
        }

        .playback-options {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
        }

        .option-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 20px;
            padding: 8px 15px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .option-btn.active {
            background: rgba(255, 255, 255, 0.3);
        }

        .option-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .speed-control-container {
            text-align: center;
            padding: 15px;
            border-style: solid;
            border-color: rgba(255, 255, 255, 0.1);
            border-width: 2px;
            border-radius: 15px;
        }

        .speed-control {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .speed-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 20px;
            padding: 8px 15px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .speed-btn.active {
            background: rgba(255, 255, 255, 0.3);
        }

        .speed-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .file-upload {
            margin-bottom: 20px;
            text-align: center;
        }

        .upload-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 20px;
            padding: 10px 20px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .upload-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .drag-prompt {
            margin-top: 3px;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
        }

        #file-input {
            display: none;
        }

        .playlist {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 10px;
        }

        .playlist-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .playlist-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .playlist-item.active {
            background: rgba(255, 255, 255, 0.2);
        }

        .playlist-item-index {
            margin-right: 10px;
            opacity: 0.7;
            width: 20px;
        }

        .playlist-item-info {
            flex: 1;
        }

        .playlist-item-title {
            font-weight: bold;
        }

        .playlist-item-filename {
            font-size: 0.9rem;
            opacity: 0.7;
        }

        .playlist-item-duration {
            opacity: 0.7;
            font-size: 0.9rem;
        }

        .empty-playlist {
            text-align: center;
            padding: 30px;
            opacity: 0.7;
        }

        footer {
            margin-top: 30px;
            text-align: center;
            opacity: 0.7;
            font-size: 0.9rem;
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        /* Drag and drop overlay styles */
        .drag-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.2);
            border: 3px dashed rgba(255, 255, 255, 0.5);
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 5;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .drag-overlay.active {
            opacity: 1;
        }

        .drag-overlay i {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .drag-overlay p {
            font-size: 1.2rem;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Онлайн Музыкальный Плеер</h1>
            <div class="subtitle">Разработано для Edge, Chrome, Safari и Firefox</div>
            
            <div class="header-controls">
                <div class="theme-selector">
                    <button class="theme-btn theme-red active" data-theme="red"></button>
                    <button class="theme-btn theme-blue" data-theme="blue"></button>
                    <button class="theme-btn theme-green" data-theme="green"></button>
                    <button class="theme-btn theme-purple" data-theme="purple"></button>
                </div>
                
                <div class="language-selector">
                    <button class="language-btn" id="language-btn">
                        <i class="fas fa-globe"></i>
                        <span id="current-language">Русский</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="language-dropdown" id="language-dropdown">
                        <div class="language-option" data-lang="en">
                            <span>English</span>
                        </div>
                        <div class="language-option" data-lang="cn">
                            <span>简体中文</span>
                        </div>
                        <div class="language-option active" data-lang="ru">
                            <span>Русский</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <div class="player-container">
            <div class="player-section">
                <h2 class="section-title">Сейчас играет</h2>
                <div class="now-playing">
                    <div class="album-art">
                        <i class="fas fa-music"></i>
                    </div>
                    <div class="song-info">
                        <div class="song-title">Композиция не выбрана</div>
                        <div class="song-artist">Неизвестный исполнитель</div>
                    </div>
                </div>

                <div class="progress-container">
                    <div class="progress-bar" id="progress-bar">
                        <div class="progress" id="progress"></div>
                    </div>
                    <div class="time-display">
                        <span id="current-time">0:00</span>
                        <span id="total-time">0:00</span>
                    </div>
                </div>

                <div class="controls">
                    <button class="control-btn" id="prev-btn" title="Предыдущая">
                        <i class="fas fa-step-backward"></i>
                    </button>
                    <button class="control-btn play-pause" id="play-pause-btn" title="Воспроизвести/Пауза">
                        <i class="fas fa-play"></i>
                    </button>
                    <button class="control-btn" id="next-btn" title="Следующая">
                        <i class="fas fa-step-forward"></i>
                    </button>
                </div>
                
                <div class="playback-options-container">
                    <p>Параметры повтора</p>
                    <div class="playback-options">
                        <button class="option-btn" id="repeat-one" title="Повторять эту песню">
                            <i class="fas fa-redo"></i> Одну
                        </button>
                        <button class="option-btn" id="repeat-all" title="Повторять плейлист">
                            <i class="fas fa-repeat"></i> Все
                        </button>
                        <button class="option-btn active" id="no-repeat" title="Без повтора">
                            <i class="fas fa-ban"></i> Нет
                        </button>
                    </div>
                </div>

                <div class="speed-control-container">
                    <p>Скорость воспроизведения</p>
                    <div class="speed-control">
                        <button class="speed-btn" data-speed="0.5">0.5x</button>
                        <button class="speed-btn" data-speed="0.75">0.75x</button>
                        <button class="speed-btn active" data-speed="1">1x</button>
                        <button class="speed-btn" data-speed="1.25">1.25x</button>
                        <button class="speed-btn" data-speed="1.5">1.5x</button>
                        <button class="speed-btn" data-speed="2">2x</button>
                    </div>
                </div>
            </div>
            
            <div class="playlist-section" id="playlist-section">
                <div class="drag-overlay" id="drag-overlay">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p>Перетащите аудиофайлы сюда</p>
                </div>
                <h2 class="section-title">Плейлист</h2>
                <div class="file-upload">
                    <label for="file-input" class="upload-btn">
                        <i class="fas fa-plus"></i> Добавить музыку
                    </label>
                    <p class="drag-prompt">или перетащите файл сюда</p>
                    <input type="file" id="file-input" accept=".mp3,.wav,.flac" multiple>
                </div>
                <div class="playlist" id="playlist">
                    <div class="empty-playlist">
                        <i class="fas fa-music" style="font-size: 3rem; margin-bottom: 10px;"></i>
                        <p>Ваш плейлист пуст</p>
                        <p>Добавьте музыкальные файлы, чтобы начать</p>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <p>Онлайн Музыкальный Плеер &copy; 2025 HSYWEBSITES | Версия 1.03</p>
            <p>Поддерживает форматы MP3, WAV и FLAC | Совместим с Microsoft Edge, Google Chrome, Safari и Mozilla Firefox | Совместим со всеми типами устройств</p>
        </footer>
    </div>

    <script>
        // DOM Elements
        const fileInput = document.getElementById('file-input');
        const playlistElement = document.getElementById('playlist');
        const playlistSection = document.getElementById('playlist-section');
        const dragOverlay = document.getElementById('drag-overlay');
        const songTitleElement = document.querySelector('.song-title');
        const songArtistElement = document.querySelector('.song-artist');
        const playPauseBtn = document.getElementById('play-pause-btn');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const progressBar = document.getElementById('progress-bar');
        const progress = document.getElementById('progress');
        const currentTimeElement = document.getElementById('current-time');
        const totalTimeElement = document.getElementById('total-time');
        const repeatOneBtn = document.getElementById('repeat-one');
        const repeatAllBtn = document.getElementById('repeat-all');
        const noRepeatBtn = document.getElementById('no-repeat');
        const speedButtons = document.querySelectorAll('.speed-btn');
        const languageBtn = document.getElementById('language-btn');
        const languageDropdown = document.getElementById('language-dropdown');
        const currentLanguageElement = document.getElementById('current-language');
        const languageOptions = document.querySelectorAll('.language-option');
        const themeButtons = document.querySelectorAll('.theme-btn');

        // Player State
        let playlist = [];
        let currentTrackIndex = -1;
        let isPlaying = false;
        let repeatMode = 'none'; // 'none', 'one', 'all'
        let playbackSpeed = 1.0;
        let audio = new Audio();
        let isDragging = false;
        let currentLanguage = 'ru';

        // Format time from seconds to MM:SS
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
        }

        // Extract metadata from audio file
        function extractMetadata(file, callback) {
            const url = URL.createObjectURL(file);
            const audio = new Audio();
            
            audio.addEventListener('loadedmetadata', function() {
                let title, artist;
                
                // Try to extract ID3 tags for MP3 files
                if (file.type === 'audio/mpeg' || file.type === 'audio/flac') {
                    new Promise((resolve) => {
                        jsmediatags.read(file, {
                            onSuccess: function(tag) {
                                const tags = tag.tags;
                                resolve({
                                    title: tags.title || file.name.replace(/\.[^/.]+$/, ""),
                                    artist: tags.artist || "Неизвестный исполнитель"
                                });
                            },
                            onError: function() {
                                resolve({
                                    title: file.name.replace(/\.[^/.]+$/, ""),
                                    artist: "Неизвестный исполнитель"
                                });
                            }
                        });
                    }).then(metadata => {
                        const audio = new Audio();
                        audio.addEventListener('loadedmetadata', function() {
                            callback({
                                title: metadata.title,
                                artist: metadata.artist,
                                duration: audio.duration,
                                file: file,
                                url: url
                            });
                        });
                        audio.src = url;
                    });
                } 
                // WAV files typically don't have metadata
                else {
                    title = file.name.replace(/\.[^/.]+$/, "");
                    artist = "Неизвестный исполнитель";
                    callback({
                        title: title,
                        artist: artist,
                        duration: audio.duration,
                        file: file,
                        url: url
                    });
                }
            });
            
            audio.src = url;
        }

        // Add files to playlist
        function addFilesToPlaylist(files) {
            files.forEach(file => {
                extractMetadata(file, function(metadata) {
                    playlist.push(metadata);
                    updatePlaylistDisplay();
                    
                    // Auto-play first track if it's the first file added
                    if (playlist.length === 1) {
                        currentTrackIndex = 0;
                        loadTrack(currentTrackIndex);
                        playTrack();
                    }
                });
            });
        }

        // Add files to playlist from file input
        fileInput.addEventListener('change', function(e) {
            const files = Array.from(e.target.files);
            addFilesToPlaylist(files);
        });

        // Update playlist display
        function updatePlaylistDisplay() {
            if (playlist.length === 0) {
                playlistElement.innerHTML = `
                    <div class="empty-playlist">
                        <i class="fas fa-music" style="font-size: 3rem; margin-bottom: 10px;"></i>
                        <p>Ваш плейлист пуст</p>
                        <p>Добавьте музыкальные файлы, чтобы начать</p>
                    </div>
                `;
                return;
            }
            
            playlistElement.innerHTML = '';
            
            playlist.forEach((track, index) => {
                const item = document.createElement('div');
                item.className = `playlist-item ${index === currentTrackIndex ? 'active' : ''}`;
                item.innerHTML = `
                    <div class="playlist-item-index">${index + 1}</div>
                    <div class="playlist-item-info">
                        <div class="playlist-item-title">${track.title}</div>
                        <div class="playlist-item-filename">${track.file.name}</div>
                    </div>
                    <div class="playlist-item-duration">${formatTime(track.duration)}</div>
                `;
                
                item.addEventListener('click', () => {
                    currentTrackIndex = index;
                    loadTrack(currentTrackIndex);
                    playTrack();
                    updatePlaylistDisplay();
                });
                
                playlistElement.appendChild(item);
            });
        }

        // Load a track
        function loadTrack(index) {
            if (index < 0 || index >= playlist.length) return;
            
            const track = playlist[index];
            audio.src = track.url;
            audio.playbackRate = playbackSpeed; // Apply current playback speed
            songTitleElement.textContent = track.title;
            songArtistElement.textContent = track.artist;
            document.title = track.title;
            
            audio.addEventListener('loadedmetadata', () => {
                totalTimeElement.textContent = formatTime(audio.duration);
            });
            
            audio.addEventListener('timeupdate', updateProgress);
            audio.addEventListener('ended', handleTrackEnd);
            
            updatePlaylistDisplay();
        }

        // Play track
        function playTrack() {
            audio.play();
            isPlaying = true;
            playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
        }

        // Pause track
        function pauseTrack() {
            audio.pause();
            isPlaying = false;
            playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
        }

        // Toggle play/pause
        playPauseBtn.addEventListener('click', () => {
            if (playlist.length === 0) return;
            
            if (isPlaying) {
                pauseTrack();
            } else {
                playTrack();
            }
        });

        // Previous track
        prevBtn.addEventListener('click', () => {
            if (playlist.length === 0) return;
            
            currentTrackIndex = (currentTrackIndex - 1 + playlist.length) % playlist.length;
            loadTrack(currentTrackIndex);
            playTrack();
        });

        // Next track
        nextBtn.addEventListener('click', () => {
            if (playlist.length === 0) return;
            
            if (repeatMode === 'one') {
                audio.currentTime = 0;
                playTrack();
            } else {
                currentTrackIndex = (currentTrackIndex + 1) % playlist.length;
                loadTrack(currentTrackIndex);
                playTrack();
            }
        });

        // Handle track end
        function handleTrackEnd() {
            if (repeatMode === 'one') {
                audio.currentTime = 0;
                playTrack();
            } else if (repeatMode === 'all' || currentTrackIndex < playlist.length - 1) {
                currentTrackIndex = (currentTrackIndex + 1) % playlist.length;
                loadTrack(currentTrackIndex);
                playTrack();
            } else {
                isPlaying = false;
                playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
            }
        }

        // Update progress bar
        function updateProgress() {
            if (audio.duration) {
                const percent = (audio.currentTime / audio.duration) * 100;
                progress.style.width = `${percent}%`;
                currentTimeElement.textContent = formatTime(audio.currentTime);
            }
        }

        // Set progress on click
        progressBar.addEventListener('click', (e) => {
            if (!audio.duration) return;
            
            const rect = progressBar.getBoundingClientRect();
            const percent = (e.clientX - rect.left) / rect.width;
            audio.currentTime = percent * audio.duration;
        });

        // Set progress on drag
        progressBar.addEventListener('mousedown', (e) => {
            isDragging = true;
            setProgress(e);
        });

        document.addEventListener('mousemove', (e) => {
            if (isDragging) {
                setProgress(e);
            }
        });

        document.addEventListener('mouseup', () => {
            isDragging = false;
        });

        function setProgress(e) {
            if (!audio.duration) return;
            
            const rect = progressBar.getBoundingClientRect();
            let percent = (e.clientX - rect.left) / rect.width;
            percent = Math.max(0, Math.min(1, percent)); // Clamp between 0 and 1
            audio.currentTime = percent * audio.duration;
        }

        // Repeat mode buttons
        repeatOneBtn.addEventListener('click', () => {
            repeatMode = 'one';
            setActiveRepeatButton(repeatOneBtn);
        });

        repeatAllBtn.addEventListener('click', () => {
            repeatMode = 'all';
            setActiveRepeatButton(repeatAllBtn);
        });

        noRepeatBtn.addEventListener('click', () => {
            repeatMode = 'none';
            setActiveRepeatButton(noRepeatBtn);
        });

        function setActiveRepeatButton(button) {
            [repeatOneBtn, repeatAllBtn, noRepeatBtn].forEach(btn => {
                btn.classList.remove('active');
            });
            button.classList.add('active');
        }

        // Speed control buttons
        speedButtons.forEach(button => {
            button.addEventListener('click', () => {
                playbackSpeed = parseFloat(button.getAttribute('data-speed'));
                audio.playbackRate = playbackSpeed;
                
                // Update active state
                speedButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
            });
        });

        // Drag and drop functionality
        playlistSection.addEventListener('dragover', (e) => {
            e.preventDefault();
            dragOverlay.classList.add('active');
        });

        playlistSection.addEventListener('dragleave', (e) => {
            // Only remove active class if leaving the playlist section
            if (!playlistSection.contains(e.relatedTarget)) {
                dragOverlay.classList.remove('active');
            }
        });

        playlistSection.addEventListener('drop', (e) => {
            e.preventDefault();
            dragOverlay.classList.remove('active');
            
            const files = Array.from(e.dataTransfer.files);
            const audioFiles = files.filter(file => 
                file.type.startsWith('audio/') || 
                ['.mp3', '.wav', '.flac'].some(ext => file.name.toLowerCase().endsWith(ext))
            );
            
            if (audioFiles.length > 0) {
                addFilesToPlaylist(audioFiles);
            }
        });
        
        // Language selector functionality
        languageBtn.addEventListener('click', () => {
            languageDropdown.classList.toggle('active');
        });
        
        languageOptions.forEach(option => {
            option.addEventListener('click', () => {
                const lang = option.getAttribute('data-lang');
                if (lang !== currentLanguage) {
                    currentLanguage = lang;
                    currentLanguageElement.textContent = option.querySelector('span').textContent;
                    
                    languageOptions.forEach(opt => opt.classList.remove('active'));
                    option.classList.add('active');
                    
                    languageDropdown.classList.remove('active');

                    if (lang == 'en') {
                      window.location.replace('../en');
                    }
                    if (lang == 'cn') {
                      window.location.replace('../cn/');
                    }
                }
            });
        });
        
        // Close language dropdown when clicking outside
        document.addEventListener('click', (e) => {
            if (!languageBtn.contains(e.target) && !languageDropdown.contains(e.target)) {
                languageDropdown.classList.remove('active');
            }
        });

        // Theme selector functionality
        themeButtons.forEach(button => {
            button.addEventListener('click', () => {
                const theme = button.getAttribute('data-theme');
                
                // Update active state
                themeButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                
                // Apply theme
                applyTheme(theme);
            });
        });

        // Apply theme
        function applyTheme(theme) {
            const root = document.documentElement;
            
            switch(theme) {
                case 'red':
                    root.style.setProperty('--primary-color', '#b21f1f');
                    root.style.setProperty('--secondary-color', '#b21f1f');
                    root.style.setProperty('--bg-gradient', 'linear-gradient(135deg, #1a2a6c, var(--secondary-color), #fdbb2d)');
                    break;
                case 'blue':
                    root.style.setProperty('--primary-color', '#096dd9');
                    root.style.setProperty('--secondary-color', '#096dd9');
                    root.style.setProperty('--bg-gradient', 'linear-gradient(135deg, #00b09b, var(--secondary-color))');
                    break;
                case 'green':
                    root.style.setProperty('--primary-color', '#1db954');
                    root.style.setProperty('--secondary-color', '#1db954');
                    root.style.setProperty('--bg-gradient', 'linear-gradient(135deg, #1a2a6c, var(--secondary-color), #fdbb2d)');
                    break;
                case 'purple':
                    root.style.setProperty('--primary-color', '#8a2be2');
                    root.style.setProperty('--secondary-color', '#8a2be2');
                    root.style.setProperty('--bg-gradient', 'linear-gradient(135deg, #1a2a6c, var(--secondary-color), #fdbb2d)');
                    break;
            }
        }

        // Initialize
        updatePlaylistDisplay();
    </script>
</body>
</html>
